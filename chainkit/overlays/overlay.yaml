overlay: 1.0.0
info:
  title: Overlay to change the merged OpenAPI Spec 
  version: 1.0.0
actions:
  - target: $["paths"]["/v1/chains"]["get"][?(@['servers'][0]['url'] == 'https://data-api.avax.network')]["responses"]["200"]["content"]["application/json"]["schema"]
    description: Change the response schema for the /v1/chains endpoint in glacier to avoid a merger conflict with Popsicle API Spec
    update:
      $ref: "#/components/schemas/DataListChainsResponse"
  
  - target: $["paths"]["/v2/chains"]["get"][?(@['servers'][0]['url'] == 'https://popsicle-api.avax.network' || @['servers'][0]['url'] == 'https://metrics.avax.network')]["responses"]["200"]["content"]["application/json"]["schema"]
    description: Change the response schema for the /v2/chains endpoint in popsicle to avoid a merger conflict with Popsicle API Spec
    update:
      $ref: "#/components/schemas/MetricsListChainsResponse"
    
  - target: $["components"]["schemas"]["ListChainsResponse"]
    description: Remove the unused schema
    remove: true
  
  - target: $["components"]["schemas"]["Blockchain"]["required"][?(@ == "evmChainId")]
    description: Update the required fields from the Blockchain schema to make evmChainId optional, remove once glacier is merged
    remove: true

  - target: $.info
    description: Add a description to the OpenAPI spec
    update:
      description: The Avalanche API suite offers powerful tools for real-time and historical blockchain data. The Webhooks API enables instant monitoring of on-chain events, including smart contract activity, NFT transfers, and wallet transactions, with customizable filters and secure notifications. The Metrics API (Beta) provides analytics on blockchain activity, while the Data API (Beta) delivers multi-chain data for Avalanche and Ethereum, including transaction history, token balances, and metadata. These APIs empower developers to build dynamic web3 applications with real-time insights and seamless integration.
      title: Data, Metrics, and Webhooks API

  - target: $.paths['/v1/webhooks'].post
    description: Keep the /v1/webhooks POST endpoint in usage example of root readme
    update:
      x-speakeasy-usage-example: true

  - target: $.paths['/v1/avax/supply'].get
    description: Rename the method name for /v1/avax/supply GET endpoint
    update:
      x-speakeasy-name-override: get

  - target: $.paths.*.*[?(@['tags'][0] == 'Notifications')]
    description: Remove all paths that are tagged with 'notifications' if they somehow exist
    update:
      x-speakeasy-ignore: true
  
  - target: $.paths.*.*[?(@.deprecated == true && (@['servers'][0]['url'] == 'https://popsicle-api.avax.network' || @['servers'][0]['url'] == 'https://metrics.avax.network'))]
    description: Remove all deprecated paths
    update:
      x-speakeasy-ignore: true

  - target: $.paths['/v2/lookingGlass/compositeQuery']
    description: Remove the /v2/lookingGlass/compositeQuery path
    update:
      x-speakeasy-ignore: true

  - target: $.paths['/v1/lookingGlass/compositeQuery']
    description: Remove the /v1/lookingGlass/compositeQuery path
    update:
      x-speakeasy-ignore: true
  
  - target: $.paths['/v1/networks/{network}/blockchains/{blockchainId}/utxos'].post.responses
    description: Add a 201 status code to the response
    update:
      '201':
        description: Successful response
        content:
          "application/json":
            schema:
              oneOf: 
                - {$ref: "#/components/schemas/ListPChainUtxosResponse"}
                - {$ref: "#/components/schemas/ListUtxosResponse"}

  - target: "$.paths['/v2/chains/{chainId}/btcb/bridged:getAddresses']"
    remove: true
  
  - target: $.paths
    description: fix the endpoint as only 43114 is supported
    update: 
      "/v2/chains/43114/btcb/bridged:getAddresses":
        get:
          tags:
            - "Looking Glass"
          summary: "Get addresses by BTCb bridged balance"
          description: "Get list of addresses and their net bridged amounts that have bridged more than a certain threshold."
          operationId: "getAddressesByBtcbBridged"
          parameters:
            - name: "threshold"
              in: "query"
              description: "The minimum balance for which addresses should be considered."
              required: true
              schema:
                type: "string"
              example: "1000000"
            - name: "pageToken"
              in: "query"
              description: "A page token, received from a previous list call. Provide this to retrieve the subsequent page."
              required: false
              schema:
                type: "string"
            - name: "pageSize"
              in: "query"
              description: "The maximum number of items to return. The minimum page size is 1. The maximum pageSize is 5000."
              required: false
              schema:
                type: "integer"
                maximum: 5000
                minimum: 1
                default: 1000
              example: "10"
          responses:
            "200":
              description: "Successful response"
              content:
                "application/json":
                  schema: {"$ref": "#/components/schemas/LookingGlassResponse"}
            "400":
              description: "Bad requests generally mean the client has passed invalid \n    or malformed parameters. Error messages in the response could help in \n    evaluating the error."
              content:
                "application/json":
                  schema: {"$ref": "#/components/schemas/BadRequest"}
            "401":
              description: "When a client attempts to access resources that require \n    authorization credentials but the client lacks proper authentication \n    in the request, the server responds with 401."
              content:
                "application/json":
                  schema: {"$ref": "#/components/schemas/Unauthorized"}
            "403":
              description: "When a client attempts to access resources with valid\n    credentials but doesn't have the privilege to perform that action, \n    the server responds with 403."
              content:
                "application/json":
                  schema: {"$ref": "#/components/schemas/Forbidden"}
            "404":
              description: "The error is mostly returned when the client requests\n    with either mistyped URL, or the passed resource is moved or deleted, \n    or the resource doesn't exist."
              content:
                "application/json":
                  schema: {"$ref": "#/components/schemas/NotFound"}
            "429":
              description: "This error is returned when the client has sent too many,\n    and has hit the rate limit."
              content:
                "application/json":
                  schema: {"$ref": "#/components/schemas/TooManyRequests"}
            "500":
              description: "The error is a generic server side error that is \n    returned for any uncaught and unexpected issues on the server side. \n    This should be very rare, and you may reach out to us if the problem \n    persists for a longer duration."
              content:
                "application/json":
                  schema: {"$ref": "#/components/schemas/InternalServerError"}
            "502":
              description: "This is an internal error indicating invalid response \n      received by the client-facing proxy or gateway from the upstream server."
              content:
                "application/json":
                  schema: {"$ref": "#/components/schemas/BadGateway"}
            "503":
              description: "The error is returned for certain routes on a particular\n    Subnet. This indicates an internal problem with our Subnet node, and may \n    not necessarily mean the Subnet is down or affected."
              content:
                "application/json":
                  schema: {"$ref": "#/components/schemas/ServiceUnavailable"}
          x-execution-weight: "large"
          x-speakeasy-group: "metrics.chains"
          x-speakeasy-name-override: "listBTCbBridgersAboveThreshold"
          x-speakeasy-pagination: {"type": "cursor", "inputs": [{"name": "pageToken", "in": "parameters", "type": "cursor"}], "outputs": {"nextCursor": "$.nextPageToken"}}
          servers:
            - url: "https://metrics.avax.network"
  

  - target: $
    description: Add a servers list to the OpenAPI spec
    update:
      servers:
        - url: https://data-api.avax.network
          description: Data API
      x-speakeasy-globals:
        parameters:
          - name: enableTelemetry
            in: path
            description: A flag to enable or disable telemetry
            schema:
              type: boolean
            x-speakeasy-globals-hidden: true 
            default: true
          - name: avacloud
            in: path
            description: A flag to use represent a avacloud api key holder
            schema:
              type: boolean
            x-speakeasy-globals-hidden: true 
            default: false
          
  
